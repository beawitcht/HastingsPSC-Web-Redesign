function updateBlockFields(e){const t=e.querySelector(".block-type"),n=e.querySelector(".content-label"),o=e.querySelector(".block-content"),l=e.querySelector(".image-url-label"),c=e.querySelector(".block-image-url"),r=e.querySelector(".alt-text-label"),a=e.querySelector(".block-alt-text"),i=e.querySelector(".url-text-label"),s=e.querySelector(".block-url-text");if(!t)return;const d=t.value;function u(e,t){e&&(t?(e.classList.remove("no-display"),e.removeAttribute("disabled")):(e.classList.add("no-display"),e.disabled=!0))}n.textContent="figure"===d?"Caption":"Content","image"===d?(u(n,!1),u(o,!1),u(l,!0),u(c,!0),u(r,!0),u(a,!0),u(i,!1),u(s,!1)):"figure"===d?(n.textContent="Caption",u(n,!0),u(o,!0),u(l,!0),u(c,!0),u(r,!0),u(a,!0),u(i,!1),u(s,!1)):"link"===d?(n.textContent="URL",u(n,!0),u(o,!0),u(l,!1),u(c,!1),u(r,!1),u(a,!1),u(i,!0),u(s,!0)):"paragraph"===d?(u(n,!0),u(o,!0),u(l,!1),u(c,!1),u(r,!1),u(a,!1),u(i,!1),u(s,!1)):"break"===d?(u(n,!1),u(o,!1),u(l,!1),u(c,!1),u(r,!1),u(a,!1),u(i,!1),u(s,!1)):(n.textContent="Content",u(n,!0),u(o,!0),u(l,!1),u(c,!1),u(r,!1),u(a,!1),u(i,!1),u(s,!1))}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("add-block-btn"),t=document.getElementById("blocks-container"),n=document.getElementById("block-template"),o=document.getElementById("article-post");let l=0;function c(e,n,o){e.addEventListener("click",(function(e){e.preventDefault();const r=document.getElementById(n);r&&(r.remove(),function(e){const n=t.querySelectorAll(".article-block");for(let t=0;t<n.length;t++){const o=n[t],l=parseInt(o.id.split("-")[1]);if(l>e){const e=l-1;o.id=`block-${e}`,o.querySelectorAll("[name], [id], [for]").forEach((t=>{t.name&&(t.name=t.name.replace(`article-blocks-${l}-`,`article-blocks-${e}-`)),t.id&&(t.id=t.id.replace(`article-blocks-${l}-`,`article-blocks-${e}-`)),t.htmlFor&&(t.htmlFor=t.htmlFor.replace(`article-blocks-${l}-`,`article-blocks-${e}-`))}));const t=o.querySelector(`#rmv-block-btn-${l}`);t&&(t.id=`rmv-block-btn-${e}`,c(t,`block-${e}`,e))}}}(o),l--)}))}o.addEventListener("click",(function(e){confirm("Are you sure you want to upload this article?")||e.preventDefault()})),t.querySelectorAll(".article-block").forEach((e=>{const t=e.querySelector(".block-type");t&&(t.addEventListener("change",(()=>updateBlockFields(e))),updateBlockFields(e))}));const r=document.querySelectorAll(".article-block");r.length&&r.length>0&&(l=r.length-1),e.addEventListener("click",(function(e){e.preventDefault();const o=n.cloneNode(!0);o.classList.remove("no-display"),o.removeAttribute("disabled");const r=o.innerHTML.replace(/__INDEX__/g,l);o.innerHTML=r,o.id=`block-${l}`;o.querySelector(".block-type").addEventListener("change",(function(){updateBlockFields(o)}));const a=o.querySelector(`#rmv-block-btn-${l}`);a&&c(a,`block-${l}`,l),t.appendChild(o),l++})),document.getElementById("preview-button").addEventListener("click",(async function(){const e=document.getElementById("article-form"),t=new FormData(e),n=document.getElementById("preview-shadow-host"),o=document.getElementById("preview-spinner"),l=document.getElementById("preview-error"),c=Date.now();o.style.display="flex",l.textContent="",await fetch(`/HDPSC-admin-panel/preview-article?ts=${c}`,{method:"POST",body:t}).then((async e=>{if(!e.ok){const t=await e.json();if(t.errors){let e="";for(const[n,o]of Object.entries(t.errors))e+=`${n}: ${o.join(", ")}\n`;throw new Error(e)}throw new Error(t.error||"Something went wrong")}return e.text()})).then((e=>{const t=function(e,t="preview-"){return e.replace(/id="([^"]+)"/g,((e,n)=>`id="${t}${n}"`)).replace(/for="([^"]+)"/g,((e,n)=>`for="${t}${n}"`)).replace(/name="([^"]+)"/g,((e,n)=>`name="${t}${n}"`)).replace(/class="([^"]+)"/g,((e,n)=>`class="${n.split(" ").map((e=>`${t}${e}`)).join(" ")}"`))}(e,"preview-");n.shadowRoot||n.attachShadow({mode:"open"});const o=n.shadowRoot;o.innerHTML="";const l=document.createElement("link");l.rel="stylesheet",l.href="/static/css/preview-base.css",o.appendChild(l);const c=document.createElement("link");c.rel="stylesheet",c.href="/static/css/preview-article.css",o.appendChild(c);const r=document.createElement("div");r.innerHTML=t,o.appendChild(r)})).catch((e=>{l.textContent=e.message})).finally((()=>{n.classList.remove("hidden-rendered"),o.style.display="none"}))}))}));